# Cloudflare DNS 管理系统 - 快速启动指南

## 项目已完成搭建 ✅

所有基础架构和代码已经创建完成，包括：
- ✅ 后端 API 服务（Express + TypeScript + Prisma）
- ✅ 前端 Web 应用（React + TypeScript + Material-UI）
- ✅ 数据库初始化（SQLite）
- ✅ 所有依赖已安装

---

## 快速启动

### 1. 启动后端服务

打开第一个终端窗口：

```bash
cd server
npm run dev
```

后端服务将在 **http://localhost:4001** 启动（以 `server/.env` 的 `PORT` 为准）

### 2. 启动前端服务

打开第二个终端窗口：

```bash
cd client
npm run dev
```

前端应用将在 **http://localhost:5173** 启动

### 3. 访问应用

在浏览器中打开：**http://localhost:5173**

---

## 首次使用

### 注册账户

1. 访问 http://localhost:5173/register
2. 填写注册信息：
   - 用户名（至少 3 个字符）
   - 邮箱
   - 密码（至少 8 位，包含大小写字母和数字）
   - **Cloudflare API Token**（必需）
   - 无需填写 Cloudflare Account ID（系统会自动获取；Token 需包含 Account:Read 权限）

### 获取 Cloudflare API Token

1. 登录 [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. 点击右上角头像 → **My Profile**
3. 左侧菜单选择 **API Tokens**
4. 点击 **Create Token**
5. 选择 **Edit zone DNS** 模板或自定义权限
6. 复制生成的 Token 并保存

### 登录系统

注册成功后，使用用户名和密码登录系统。

---

## 主要功能

### 1. 域名管理
- 查看所有 Cloudflare 域名
- 搜索和筛选域名
- 查看域名状态

### 2. DNS 记录管理
- 查看所有 DNS 记录
- 快速添加 DNS 记录（A、AAAA、CNAME、MX、TXT 等）
- 编辑和删除 DNS 记录
- 设置 TTL 和代理状态

### 3. 自定义主机名
- 添加自定义主机名
- 查看 SSL 证书状态
- 管理主机名验证

### 4. 操作日志
- 查看所有操作记录
- 按时间、类型、状态筛选
- 导出日志数据

### 5. 设置
- 修改密码
- 更新 Cloudflare API Token

---

## 项目结构

```
CF/
├── client/                 # React 前端
│   ├── src/
│   │   ├── components/     # 可复用组件
│   │   ├── pages/          # 页面组件
│   │   ├── services/       # API 服务
│   │   ├── utils/          # 工具函数
│   │   └── types/          # TypeScript 类型
│   └── package.json
│
├── server/                 # Node.js 后端
│   ├── src/
│   │   ├── routes/         # API 路由
│   │   ├── services/       # 业务逻辑
│   │   ├── middleware/     # 中间件
│   │   └── config/         # 配置
│   ├── prisma/             # 数据库模型
│   └── package.json
│
├── .env.example            # 环境变量示例
└── README.md               # 项目说明
```

---

## 常用命令

### 后端

```bash
# 开发模式
npm run dev

# 构建生产版本
npm run build

# 启动生产版本
npm start

# 查看数据库
npx prisma studio

# 创建数据库迁移
npx prisma migrate dev
```

### 前端

```bash
# 开发模式
npm run dev

# 构建生产版本
npm run build

# 预览生产版本
npm run preview
```

---

## 环境变量配置

后端环境变量（`server/.env`）：

```env
NODE_ENV=development
PORT=4001
DATABASE_URL="file:./database.db"
JWT_SECRET="dev-secret-key-change-in-production-12345"
JWT_EXPIRES_IN="7d"
ENCRYPTION_KEY="dev-encryption-key-32-chars!!"
CORS_ORIGIN="http://localhost:5173"
LOG_RETENTION_DAYS=90
```

⚠️ **生产环境请务必修改 JWT_SECRET 和 ENCRYPTION_KEY！**

---

## API 接口文档

### 认证相关
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/me` - 获取当前用户信息
- `PUT /api/auth/password` - 修改密码
- `PUT /api/auth/cf-token` - 更新 API Token

### 域名相关
- `GET /api/domains` - 获取域名列表
- `GET /api/domains/:zoneId` - 获取域名详情
- `POST /api/domains/refresh` - 刷新缓存

### DNS 记录相关
- `GET /api/dns/:zoneId/records` - 获取 DNS 记录
- `POST /api/dns/:zoneId/records` - 创建 DNS 记录
- `PUT /api/dns/:zoneId/records/:recordId` - 更新 DNS 记录
- `DELETE /api/dns/:zoneId/records/:recordId` - 删除 DNS 记录

### 自定义主机名相关
- `GET /api/hostnames/:zoneId` - 获取主机名列表
- `POST /api/hostnames/:zoneId` - 创建主机名
- `DELETE /api/hostnames/:zoneId/:hostnameId` - 删除主机名

### 日志相关
- `GET /api/logs` - 获取操作日志
- `DELETE /api/logs/cleanup` - 清理过期日志

---

## 故障排查

### 后端无法启动

1. 检查端口（默认 4001）是否被占用（以 `server/.env` 的 `PORT` 为准）
2. 确认 `.env` 文件存在且配置正确
3. 确认数据库已初始化：`npx prisma migrate dev`

### 前端无法连接后端

1. 确认后端服务已启动
2. 检查 `vite.config.ts` 中的 proxy 配置
3. 查看浏览器控制台的网络请求

### 登录后无法访问 API

1. 检查 Cloudflare API Token 是否有效
2. 确认 Token 权限包含 DNS 编辑权限
3. 查看后端日志中的错误信息

---

## 下一步开发建议

### 功能增强
- [ ] DNS 记录批量导入/导出
- [ ] DNS 记录模板功能
- [ ] 域名分组管理
- [ ] 操作日志导出（CSV/JSON）
- [ ] 邮件/Webhook 通知

### 性能优化
- [ ] 实现 Redis 缓存（替代内存缓存）
- [ ] 添加请求防抖和节流
- [ ] 实现虚拟滚动（大量记录时）

### 安全增强
- [ ] 添加双因素认证（2FA）
- [ ] IP 白名单功能
- [ ] 操作审计日志

---

## 技术支持

如有问题，请查看：
- [项目规划文档](./项目规划.md) - 完整的技术设计文档
- [Cloudflare API 文档](https://developers.cloudflare.com/api/)
- [Material-UI 文档](https://mui.com/)
- [Prisma 文档](https://www.prisma.io/docs)

---

**祝您使用愉快！** 🎉
